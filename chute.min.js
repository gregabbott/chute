/*https://gregabbott.github.io/chute By + (C) Greg Abbott 2024. V: 2024-12-02.1*/
const chute=(()=>{const e=[],n=(...e)=>{throw new Error(e)},t=e=>e instanceof Function,r=e=>"number"==typeof e&&!isNaN(e),i=e=>Array.isArray(e),o=e=>t(globalThis[e]),l=new Map,a=(o,...l)=>function({seed:o,fns:l}){let a=null,f=null;const s=e=>{f&&f(e),a=e},h=()=>a;function p(n,t){return e.push(t),b}function y(o,l,p){if(0==e.length)return 0===p.length?h():(s(c(p,h())),b);let y=e.length-1;return e.reduce(((o,l,b)=>e.length>1&&b!==y?("log"==l?console.log(h()):"if"==l?n(".if needs 1-2 arguments"):"tap"==l?n(".tap needs 1 fn argument"):"do"===l?n(".do needs 1+ arguments"):r(Number(l))?s(a[l]):l&&s(d(h(),l,[])),o):(1!==e.length&&b!==y||("log"==l?console.log(...p,h()):"with"==l?null!==f?n("already set up. 1 with per chute"):1===p.length&&t(p[0])?(f=p[0],f(a)):n("with accepts v=>your_variable=v"):"if"==l?s((({args:e,data:r})=>{if(2==e.length)return(({when:e,then:n,data:r})=>{let i=e;t(e)&&(u(e),i=g(e,r,[]));if(i&&t(n))return u(n),g(n,r,[]);if(i)return n;return r})({when:e[0],then:e[1],data:r});if(1==e.length&&(o=e[0],o&&"object"==typeof o&&!Array.isArray(o))&&function(e){const n=Object.keys(e),t=e=>0 in e&&1 in e;if(!("if"in e&&i(e.if)&&t(e.if)))return!1;const r=("else"in e)+("else_if"in e);if("else_if"in e){if(!i(e.else_if))return!1;if(e.else_if.length>0&&!e.else_if.every((e=>i(e)&&t(e))))return!1}return n.length-1-r==0&&r<=2}(e[0])){let n=function(e,n){function r({condition:e,data:n}){return t(e)?e(n):e}if([e.if,...e.else_if].forEach((([e,n])=>{t(e)&&u(e),t(n)&&u(n)})),r({condition:e.if[0],data:n}))return e.if[1];if("else_if"in e)for(const[t,i]of e.else_if)if(r({condition:t,data:n}))return i;if("else"in e)return e.else;return n}(e[0],r);return r===n?r:t(n)?g(n,r,[]):n}var o;return n(".if block incorrect"),r})({args:p,data:h()})):"tap"==l?t(p[0])?p[0](h()):n("give .tap a fn to send data to"):"do"===l?s(c(p,h())):r(Number(l))?(s(a[l]),s(c(p,h()))):l&&s(d(h(),l,p)),e.length=0),o)),b)}let b=new Proxy((()=>{}),{get:p,apply:y});s(o),l.length>0&&s(c(l,o));return b}({seed:o,fns:l}),f={};function u(e){return e.name&&!o(e.name)&&(l.has(e.name)||l.set(e.name,e)),e}function s(e,n){return"log"===n?(console.log(e),e):t(n)?(u(n),n(e)):n}a.x=f;const c=(e,n)=>e.reduce(s,n),h=new Set(["forEach","push","unshift"]),g=(e,n,t)=>{if(0===t.length)return e(n);let r=t.indexOf(f);return-1!==r?(t[r]=n,e(...t)):e(...t)(n)},d=(e,r,i)=>{if(a=e,u=r,t(Object.getPrototypeOf(a)[u])){let n=i.indexOf(f);-1!==n&&(i[n]=e);let t=e[r](...i);return h.has(r)?e:t}var a,u;if(o(r)){let n=globalThis[r];return g(n,e,i)}return l.has(r)?g(l.get(r),e,i):(n(`Data lacks "${r}" and not a global function`),e)};return a})();