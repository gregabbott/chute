/*https://github.com/gregabbott/chute By + (C) Greg Abbott 2024. V: 2024-11-28.3*/

const chute=(()=>{let t,e=[],n={};const o=(...t)=>{throw new Error(t)},l=t=>t instanceof Function,a=(t,e)=>l(Object.getPrototypeOf(t)[e]);function r(t,e){if("log"===e)return console[e](t),t;if("string"==typeof e){if(a(t,e))return i(e,[]);o(`Data lacks "${e}" method`)}else{if(l(e))return e(t);o("Not a function:",e)}return t}const s=e=>e.reduce(r,t),g=["forEach","push","unshift"];const i=(e,r)=>{if(a(t,e))return g.includes(e)?t[e](...r):t=t[e](...r),t;if(l(globalThis[e])){if(0==r.length&&(t=globalThis[e](t)),r.length>0){let o=r.indexOf(n);-1!==o?(r[o]=t,t=globalThis[e](...r)):t=globalThis[e](...r)(t)}}else o(`Data lacks "${e}" method|Not a global Fn`)};const f=new Proxy((function(){}),{get:(t,n)=>(e.push(n),f),apply:(n,a,r)=>{if(0==e.length)return 0===r.length?t:(t=s(r),f);let g=e.length-1;return e.reduce(((n,a,f)=>{let c=a;return e.length>1&&f!==g?("log"==c?console.log(t):"if"==c?o(".if needs 2 arguments"):"tap"==c?o(".tap needs 1 fn argument"):"and"===c?o(".and needs 1+ arguments"):c&&i(c,[]),n):(1!==e.length&&f!==g||(e.length=0,"log"==c?console.log(...r,t):"if"==c?(({cond:e,fn:n})=>{const a=l(e);a||!1===e||!0===e||o("give .if(arg1) bool OR test=data=>{â€¦return bool}"),l(n)?(a&&!0===e(t)||!0===e)&&(t=n(t)):o("give .if(,arg2) a Fn to send data to",n)})({cond:r[0],fn:r[1]}):"tap"==c&&l(r[0])?r[0](t):"tap"==c?o("give .tap a fn to send data to"):"and"===c?t=s(r):c&&i(c,r)),n)}),f)}});let c=(e,...n)=>(t=e,n.length>0&&(t=s(n)),f);return c._=n,c})();